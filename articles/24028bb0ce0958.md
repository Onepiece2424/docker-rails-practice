---
title: "ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ãŸã‚«ãƒ©ãƒ ã®å€¤ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹æ–¹æ³•"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['ruby', 'rails']
published: true
---

### èƒŒæ™¯

å®Ÿå‹™ã§ å•†å“ã®ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç”»é¢ä¸Šã‹ã‚‰åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚

ãã®æ™‚ã®å®Ÿè£…å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ³ã‹ã‚‰ã‚«ãƒ©ãƒ ï¼ˆä»Šå›ã§ã„ã†ã¨ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç®¡ç†ã™ã‚‹ã‚«ãƒ©ãƒ ï¼‰ã®å€¤ã‚’ä¸€æ‹¬ã§æ›´æ–°ã™ã‚‹æ–¹æ³•ã¨ã—ã¦è¨˜äº‹ã«ã¾ã¨ã‚ãŸã®ã§ã€åŒã˜ã‚ˆã†ãªå®Ÿè£…ã‚’ã™ã‚‹æ™‚ã®å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãƒã‚§ãƒƒã‚¯ã—ã€ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã“ã¨ã§ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ç´ã¥ãã‚«ãƒ©ãƒ ã®å€¤ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/0dd91168d16c-20240526.png)

### å®Ÿè£…

```ruby:config/routes.rb
Rails.application.routes.draw do
  resources :items do
    post "update_coupon_status", on: :collection
  end
end
```

```ruby:app/controllers/items_controller.rb
def update_coupon_status
  if params[:item].present?
    params[:item].each do |item_id, item_attributes|
      item = Item.find(item_id)
      item.update(coupon_status: item_attributes[:coupon_status])
    end
  end

  redirect_to items_path, notice: 'ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚'
end
```

```ruby:app/views/items/index.html.erb
<p style="text-align: center;" id="notice"><%= notice %></p>
<div style="text-align: center;">
  <h3>å•†å“ä¸€è¦§</h3>
</div>
<div style="text-align: center;">
    <%= form_with url: update_coupon_status_items_path, html: { style: "display: inline-block; text-align: center;" } do |f| %>
    <table style="margin: auto; display: block; text-align: center;">
      <thead>
        <tr>
          <th>å•†å“å</th>
          <th>ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr>
      </thead>

      <tbody>
        <% @items.each do |item| %>
          <tr>
            <td><%= item.name %></td>
            <td>
              <%= hidden_field_tag "item[#{item.id}][coupon_status]", "false" %>
              <%= check_box_tag "item[#{item.id}][coupon_status]", "true", item.coupon_status == true, { class: "center-checkbox" } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div style="margin: auto; text-align: center;">
      <%= f.submit 'ç™»éŒ²' %>
    </div>
  <% end %>
</div>

```

å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

**config/routes.rb**

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚`resources :items`ã¯ã€ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã™ã‚‹RESTfulãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚ãã—ã¦ã€`post "update_coupon_status", on: :collection`ã¯ã€`items`ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦`update_coupon_status`ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€è¤‡æ•°ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã¾ã¨ã‚ã¦æ›´æ–°ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

**app/controllers/items_controller.rb**

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚`update_coupon_status`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚é€ä¿¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã—ã€ãã‚Œãã‚Œã®ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã™ã€‚ãã—ã¦ã€æœ€å¾Œã«å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚

**app/views/items/index.html.erb**

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã®ãƒ“ãƒ¥ãƒ¼ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ã¦ã€ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹UIã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚å„ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠã§ãã‚‹ã‚ˆã†ã«ã—ã€ä¸€æ‹¬æ›´æ–°ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€`update_coupon_status`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

ã¡ãªã¿ã«ã§ã™ãŒã€ä¸Šè¨˜ã®ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã€ã‚µãƒ¼ãƒå´ã¸ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã¨ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

```ruby:app/controllers/items_controller.rb
     9: def update_coupon_status
 => 10:   binding.pry
    11:   if params[:item].present?
    12:     params[:item].each do |item_id, item_attributes|
    13:       item = Item.find(item_id)
    14:       item.update(coupon_status: item_attributes[:coupon_status])
    15:     end
    16:   end
    17:
    18:   redirect_to items_path, notice: 'ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚'
    19: end

[1] pry(#<ItemsController>)> params
=> #<ActionController::Parameters {"authenticity_token"=>"XXXX", "item"=>{"1"=>{"coupon_status"=>"false"}, "3"=>{"coupon_status"=>"true"}, "4"=>{"coupon_status"=>"true"}, "5"=>{"coupon_status"=>"false"}, "6"=>{"coupon_status"=>"false"}}, "commit"=>"ç™»éŒ²", "controller"=>"items", "action"=>"update_coupon_status"} permitted: false>
```

ã“ã‚Œã«ã‚ˆã‚Šã€Ruby on Railsã‚’ä½¿ç”¨ã—ã¦ç°¡å˜ã«å•†å“ã®ã‚¯ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ä¸€æ‹¬æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### å‚è€ƒ

check_box_tag

https://railsdoc.com/page/check_box_tag

form_with é…åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡

https://railsguides.jp/form_helpers.html#ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‘½åãƒ«ãƒ¼ãƒ«ã‚’ç†è§£ã™ã‚‹

https://qiita.com/i_garasi/items/81952e8198308d70069e

https://ichiro-tanaka.hatenadiary.org/entry/20090417/1239979791
